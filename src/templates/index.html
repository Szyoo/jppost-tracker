<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>快递追踪器与通知服务控制台 (Vue.js)</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"></script>
    <link rel="stylesheet" href="/static/style.css" />
  </head>
  <body>
    <div id="app" class="container">
      <div class="header">
        <h1>[[ title ]]</h1>
      </div>

      <div class="section">
        <h2>环境变量配置</h2>
        <form @submit.prevent="saveEnv" class="env-form">
          <div v-for="(value, key) in envVars" :key="key">
            <label :for="key">[[ key ]]:</label>
            <input type="text" :id="key" v-model="envVars[key]" />
          </div>
          <button type="submit">保存环境变量</button>
        </form>
        <div v-if="envMessage.text" :class="['message', envMessage.type]">[[ envMessage.text ]]</div>
      </div>

      <div class="flex-container">
        <div class="flex-child">
          <div class="section">
            <h2>快递追踪脚本</h2>
            <div class="controls">
              <button @click="startScript" :disabled="script.running" class="start">启动脚本</button>
              <button @click="stopScript" :disabled="!script.running" class="stop">停止脚本</button>
              <span :class="['status-indicator', { running: script.running, stopped: !script.running }]"></span>
              <span>[[ script.running ? '运行中' : '未运行' ]]</span>
            </div>
            <div class="log-container">
              <h3>追踪脚本实时日志</h3>
              <div class="log-output" ref="trackerLogOutput">
                <div v-for="(line, index) in script.logs" :key="index" v-html="line"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="flex-child">
          <div class="section">
            <h2>Bark 通知服务</h2>
            <div class="controls">
              <button @click="startBarkServer" :disabled="bark.running" class="start">启动服务</button>
              <button @click="stopBarkServer" :disabled="!bark.running" class="stop">停止服务</button>
              <span :class="['status-indicator', { running: bark.running, stopped: !bark.running }]"></span>
              <span>[[ bark.running ? '运行中' : '未运行' ]]</span>
            </div>
            <div class="log-container">
              <h3>Bark 服务实时日志</h3>
              <div class="log-output" ref="barkLogOutput">
                <div v-for="(line, index) in bark.logs" :key="index" v-html="line"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      window.initialEnvVars = JSON.parse("{{ env_vars | tojson | safe }}");
    </script>
    <script src="/static/app.js"></script>
  </body>
</html>
